{"remainingRequest":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js!/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/li/Desktop/foodish/src/views/person/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/li/Desktop/foodish/src/views/person/index.vue","mtime":1553345340000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.array.sort\";\nimport _Object$assign from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/core-js/object/assign\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport _objectSpread from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.map\";\nimport _toConsumableArray from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport \"core-js/modules/es6.array.filter\";\nimport \"core-js/modules/es6.function.name\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport FoodItemSmall from \"@/components/FoodItemSmall\";\nexport default {\n  components: {\n    FoodItemSmall: FoodItemSmall\n  },\n  data: function data() {\n    return {\n      last_name: \"\",\n      active: 0,\n      commitId: \"\",\n      isCommit: false,\n      image_url: \"\",\n      score: 0,\n      modal: {\n        id: \"\",\n        name: \"\",\n        date: \"\",\n        image_url: \"\",\n        score: 0,\n        content: \"\"\n      },\n      forms: {},\n      rules: {},\n      flavorList: [],\n      dislikeList: [],\n      bookList: [],\n      commitList: [],\n      foodList: [] //我做的菜列表\n\n    };\n  },\n  computed: {\n    fans_num: function fans_num() {\n      return this.$store.state.users.fans_num;\n    },\n    uname: function uname() {\n      return this.$store.state.users.name;\n    },\n    username: function username() {\n      return this.$store.state.users.username;\n    },\n    bookList2: function bookList2() {\n      return this.bookList.filter(function (item) {\n        return item.date < +new Date();\n      });\n    },\n    commingList: function commingList() {\n      var _this = this;\n\n      var d = +new Date();\n      var dayTime = 24 * 60 * 60 * 1000;\n      var list = [].concat(_toConsumableArray(this.foodList), _toConsumableArray(this.bookList));\n      return this.bookList.map(function (item) {\n        var food_detail = item.food_detail;\n\n        if (food_detail) {\n          if (d - food_detail.date <= dayTime && !food_detail.is_cancel) {\n            return _objectSpread({}, item, food_detail, {\n              orderStatus: 0,\n              orderText: \"You need to take it\"\n            });\n          }\n\n          if (food_detail.is_cancel) {\n            return _objectSpread({}, item, food_detail, {\n              orderStatus: 1,\n              orderText: \"It has been canceled\"\n            });\n          } //\n\n        }\n      }).concat(this.foodList).map(function (item) {\n        var text = \"you need to cook it\";\n\n        if (!item.is_cancel) {\n          return _objectSpread({}, item, {\n            orderStatus: 0,\n            orderText: _this.$store.state.users.id == item.author ? text : \"You need to take it\"\n          });\n        }\n\n        if (item.is_cancel) {\n          return _objectSpread({}, item, {\n            orderStatus: 1,\n            orderText: \"It has been canceled\"\n          });\n        }\n      }).filter(function (item) {\n        if (+new Date() <= item.date) {\n          return true;\n        }\n\n        return false;\n      });\n    }\n  },\n  created: function created() {\n    this.flavorList = this.$utils.flavor;\n    this.dislikeList = this.$utils.dislike;\n    this.getBookInfo();\n    this.getFoodList();\n    this.getUserInfo();\n    this.getCommitList();\n  },\n  methods: {\n    onDescChange: function () {\n      var _onDescChange = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                console.log(this.$store.state.users);\n                _context.next = 3;\n                return this.$http({\n                  url: this.API.UPDATE_USER(this.$store.state.users.id),\n                  method: \"PATCH\",\n                  data: {\n                    last_name: this.last_name\n                  }\n                });\n\n              case 3:\n                this.$Message.success(\"edit successfully\");\n                this.getUserInfo();\n\n              case 5:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function onDescChange() {\n        return _onDescChange.apply(this, arguments);\n      }\n\n      return onDescChange;\n    }(),\n    currStyle: function currStyle(img) {\n      return \"background-image:url(\".concat(img, \");width:150px;height:100px;\");\n    },\n    getCurrStyle: function getCurrStyle() {\n      return \"background-image:url(\".concat(this.image_url, \");background-size: cover;width:100%;height:200px;background-color:#eee;background-size: cover;\");\n    },\n    getCommitList: function () {\n      var _getCommitList = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var _ref, data, score;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.$http({\n                  url: this.API.COMMIT_ADD,\n                  params: {\n                    auther: this.$store.state.users.id\n                  }\n                });\n\n              case 2:\n                _ref = _context2.sent;\n                data = _ref.data;\n                score = 0;\n                data.map(function (item) {\n                  score += item.score;\n                });\n                this.score = score / data.length;\n                this.commitList = data;\n\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getCommitList() {\n        return _getCommitList.apply(this, arguments);\n      }\n\n      return getCommitList;\n    }(),\n    getUserInfo: function () {\n      var _getUserInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.$http({\n                  url: this.API.UPDATE_USER(this.$store.state.users.id),\n                  method: \"get\"\n                });\n\n              case 2:\n                _ref2 = _context3.sent;\n                data = _ref2.data;\n                this.$store.commit(\"users\", _Object$assign(this.$store.state.users, data));\n                this.image_url = data.image_url;\n                this.last_name = data.last_name;\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getUserInfo() {\n        return _getUserInfo.apply(this, arguments);\n      }\n\n      return getUserInfo;\n    }(),\n    onFileSuccess: function () {\n      var _onFileSuccess = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(res) {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.$http({\n                  url: this.API.UPDATE_USER(this.$store.state.users.id),\n                  method: \"PATCH\",\n                  data: {\n                    image_url: res.url\n                  }\n                });\n\n              case 2:\n                this.getUserInfo();\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function onFileSuccess(_x) {\n        return _onFileSuccess.apply(this, arguments);\n      }\n\n      return onFileSuccess;\n    }(),\n    getFoodList: function () {\n      var _getFoodList = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5() {\n        var _ref3, data;\n\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.$http({\n                  url: this.API.FOOD_LIST,\n                  params: {\n                    author: this.$store.state.users.id\n                  }\n                });\n\n              case 2:\n                _ref3 = _context5.sent;\n                data = _ref3.data;\n                this.foodList = data.sort(function (a, b) {\n                  if (a.date > b.date) {\n                    return -1;\n                  } else {\n                    return 1;\n                  }\n                });\n\n              case 5:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getFoodList() {\n        return _getFoodList.apply(this, arguments);\n      }\n\n      return getFoodList;\n    }(),\n    getBookInfo: function () {\n      var _getBookInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee6() {\n        var _ref4, data;\n\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.$http({\n                  url: this.API.BOOK_LIST_Q(this.$store.state.users.id)\n                });\n\n              case 2:\n                _ref4 = _context6.sent;\n                data = _ref4.data;\n                this.bookList = data.map(function (item) {\n                  if (item.food_detail) {\n                    item.food_detail = JSON.parse(item.food_detail);\n                  }\n\n                  return item;\n                });\n\n              case 5:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function getBookInfo() {\n        return _getBookInfo.apply(this, arguments);\n      }\n\n      return getBookInfo;\n    }(),\n    onClickMenu: function onClickMenu(active) {\n      this.active = active;\n    },\n    logout: function logout() {\n      this.$store.commit(\"users\", {});\n      this.$router.replace({\n        name: \"Login\"\n      });\n    },\n    onEvaluate: function onEvaluate(item) {\n      this.isCommit = true;\n      this.modal = _Object$assign(this.modal, {\n        image_url: item.image_url,\n        name: item.name,\n        date: item.date,\n        score: 0,\n        content: \"\",\n        id: item.id\n      });\n    },\n    onCommitAdd: function () {\n      var _onCommitAdd = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee7() {\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                _context7.next = 2;\n                return this.$http({\n                  url: this.API.COMMIT_ADD,\n                  method: \"post\",\n                  data: {\n                    description: this.modal.content,\n                    score: this.modal.score,\n                    auther: this.$store.state.users.id,\n                    food: this.modal.id\n                  }\n                });\n\n              case 2:\n                this.isCommit = false; //刷新列表\n\n                this.getBookInfo();\n                this.$Message.success(\"Evaluation success!\");\n\n              case 5:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function onCommitAdd() {\n        return _onCommitAdd.apply(this, arguments);\n      }\n\n      return onCommitAdd;\n    }()\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"person\">\r\n    <div class=\"person-header\">\r\n      <div class=\"person-left\" @click=\"$router.push({ name: 'Home' })\">\r\n        <img src=\"@/resource/fanhui.svg\" alt=\"\" />\r\n      </div>\r\n      <span>Foodish</span>\r\n    </div>\r\n    <div class=\"person-main-form\">\r\n      <div class=\"person-main-left\">\r\n        <ul>\r\n          <li :class=\"{ active: active === 0 }\" @click=\"onClickMenu(0)\">\r\n            Accout Information\r\n          </li>\r\n          <li :class=\"{ active: active === 1 }\" @click=\"onClickMenu(1)\">\r\n            I have bought\r\n          </li>\r\n          <li :class=\"{ active: active === 2 }\" @click=\"onClickMenu(2)\">\r\n            I have cooked\r\n          </li>\r\n          <li :class=\"{ active: active === 3 }\" @click=\"onClickMenu(3)\">\r\n            Comming order\r\n          </li>\r\n        </ul>\r\n      </div>\r\n      <div v-if=\"active === 0\" class=\"person-main-right\">\r\n        <!-- user -->\r\n        <div class=\"person-main-row\">\r\n          <div class=\"person-logo\">\r\n            <div :style=\"getCurrStyle()\" class=\"person-image\"></div>\r\n            <Upload\r\n              :on-success=\"onFileSuccess\"\r\n              name=\"img\"\r\n              :show-upload-list=\"false\"\r\n              multiple\r\n              type=\"drag\"\r\n              :action=\"API.IMAGE_UPLOAD\"\r\n            >\r\n              <Button size=\"small\">change</Button>\r\n            </Upload>\r\n            \r\n          </div>\r\n          <div class=\"person-info\">\r\n            <Rate :value=\"score\" disabled />\r\n            <p style=\"font-size:20px\" >{{uname}}</p>\r\n            <p style=\"font-size:20px\">{{username}}</p>\r\n            <p style=\"font-size:20px\">fans:{{fans_num}}</p>\r\n            <br><br>\r\n            <Input v-model=\"last_name\" type=\"textarea\" :autosize=\"{minRows: 3,maxRows:10}\" placeholder=\"Enter desc...\">\r\n\r\n            </Input>\r\n            <br><br>\r\n            <Button @click=\"onDescChange\" size=\"small\">change</Button>\r\n          </div>\r\n        </div>\r\n        <!-- loginout -->\r\n        <div class=\"person-main-row-btn\">\r\n          <Button @click=\"logout\" type=\"warning\" class=\"logout\" size=\"large\"\r\n            >logout</Button\r\n          >\r\n        </div>\r\n      </div>\r\n      <div v-if=\"active === 1\" class=\"person-main-right\" style=\"padding-top:0\">\r\n        <div class=\"not-data\" v-if=\"bookList2.length === 0\">\r\n          <img src=\"../../resource/745077899322453353.jpg\" />\r\n          <p>It is empty. Add something to it now!</p>\r\n        </div>\r\n        <FoodItemSmall\r\n          @evaluate=\"onEvaluate\"\r\n          commit\r\n          :align=\"`${index % 2 !== 0 ? 'right' : 'left'}`\"\r\n          v-for=\"(item, index) in bookList2\"\r\n          :key=\"item.id\"\r\n          :item=\"item.food_detail\"\r\n          :isCommit=\"item.is_comment\"\r\n          \r\n        />\r\n      </div>\r\n      <div v-if=\"active === 2\" class=\"person-main-right\" style=\"padding-top:0\">\r\n        <div class=\"not-data\" v-if=\"foodList.length === 0\">\r\n          <img src=\"../../resource/745077899322453353.jpg\" />\r\n          <p>It is empty. Add something to it now!</p>\r\n        </div>\r\n        <FoodItemSmall\r\n          :align=\"`${index % 2 !== 0 ? 'right' : 'left'}`\"\r\n          v-for=\"(item, index) in foodList\"\r\n          :key=\"item.id\"\r\n          :item=\"item\"\r\n        />\r\n      </div>\r\n      <div v-if=\"active === 3\" class=\"person-main-right\" style=\"padding-top:0\">\r\n        <div class=\"not-data\" v-if=\"commingList.length === 0\">\r\n          <img src=\"../../resource/745077899322453353.jpg\" />\r\n          <p>It is empty. Add something to it now!</p>\r\n        </div>\r\n        <FoodItemSmall\r\n          comming\r\n          :align=\"`${index % 2 !== 0 ? 'right' : 'left'}`\"\r\n          v-for=\"(item, index) in commingList\"\r\n          :key=\"item.id\"\r\n          :item=\"item\"\r\n        />\r\n      </div>\r\n    </div>\r\n    <!-- 评论 -->\r\n    <Modal\r\n      :value=\"isCommit\"\r\n      @on-cancel=\"isCommit = false\"\r\n      title=\"evaluate\"\r\n      :styles=\"{ width: '500px' }\"\r\n    >\r\n      <div class=\"modal-wrap\">\r\n        <div class=\"modal-inner\">\r\n          <div class=\"image\" :style=\"currStyle(modal.image_url)\"></div>\r\n          <div class=\"right\">\r\n            <p>{{ modal.name }}</p>\r\n            <p>{{ modal.date | dateFormat(\"yyyy-MM-dd hh:mm\") }}</p>\r\n          </div>\r\n        </div>\r\n        <Rate v-model=\"modal.score\" />\r\n        <Input\r\n          type=\"textarea\"\r\n          v-model=\"modal.content\"\r\n          :rows=\"4\"\r\n          placeholder=\"commit\"\r\n        ></Input>\r\n      </div>\r\n      <div slot=\"footer\" class=\"modal-footer\">\r\n        <Button @click=\"isCommit = false\">cancel</Button>\r\n        <Button @click=\"onCommitAdd\" type=\"warning\">ok</Button>\r\n      </div>\r\n    </Modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport FoodItemSmall from \"@/components/FoodItemSmall\";\r\nexport default {\r\n  components: { FoodItemSmall },\r\n  data() {\r\n    return {\r\n      last_name:\"\",\r\n      active: 0,\r\n      commitId: \"\",\r\n      isCommit: false,\r\n      image_url: \"\",\r\n      score: 0,\r\n      modal: {\r\n        id: \"\",\r\n        name: \"\",\r\n        date: \"\",\r\n        image_url: \"\",\r\n        score: 0,\r\n        content: \"\"\r\n      },\r\n      forms: {},\r\n      rules: {},\r\n      flavorList: [],\r\n      dislikeList: [],\r\n      bookList: [],\r\n      commitList: [],\r\n      foodList: [] //我做的菜列表\r\n    };\r\n  },\r\n  computed: {\r\n    fans_num(){\r\n      return this.$store.state.users.fans_num;\r\n    },\r\n    uname(){\r\n      return this.$store.state.users.name;\r\n    },\r\n    username() {\r\n      return this.$store.state.users.username;\r\n    },\r\n    bookList2(){\r\n      return this.bookList.filter(item=>item.date<+new Date())\r\n    },\r\n    commingList() {\r\n      const d = +new Date();\r\n      const dayTime = 24 * 60 * 60 * 1000;\r\n      const list = [...this.foodList,...this.bookList]\r\n      return this.bookList\r\n        .map(item => {\r\n          const food_detail = item.food_detail;\r\n          if (food_detail) {\r\n            if (d - food_detail.date <= dayTime && !food_detail.is_cancel) {\r\n              return {\r\n                ...item,\r\n                ...food_detail,\r\n                orderStatus: 0,\r\n                orderText: \"You need to take it\"\r\n              };\r\n            }\r\n\r\n            if (food_detail.is_cancel) {\r\n              return {\r\n                ...item,\r\n                ...food_detail,\r\n                orderStatus: 1,\r\n                orderText: \"It has been canceled\"\r\n              };\r\n            }\r\n\r\n            //\r\n          }\r\n        })\r\n        .concat(this.foodList)\r\n        .map((item)=>{\r\n          const text=\"you need to cook it\"\r\n          if (!item.is_cancel) {\r\n              return {\r\n                ...item,\r\n                \r\n                orderStatus: 0,\r\n                orderText:this.$store.state.users.id==item.author?text: \"You need to take it\"\r\n              };\r\n            }\r\n\r\n            if (item.is_cancel) {\r\n              return {\r\n                ...item,\r\n                \r\n                orderStatus: 1,\r\n                orderText: \"It has been canceled\"\r\n              };\r\n            }\r\n        })\r\n        .filter(item => {\r\n          if(+new Date()<=item.date) {\r\n            return true\r\n          }\r\n          return false;\r\n        });\r\n    }\r\n  },\r\n  created() {\r\n    this.flavorList = this.$utils.flavor;\r\n    this.dislikeList = this.$utils.dislike;\r\n    this.getBookInfo();\r\n    this.getFoodList();\r\n    this.getUserInfo();\r\n    this.getCommitList();\r\n  },\r\n  methods: {\r\n    async onDescChange(){\r\n      console.log(this.$store.state.users)\r\n      await this.$http({\r\n        url:this.API.UPDATE_USER( this.$store.state.users.id),\r\n        method: \"PATCH\",\r\n        data:{\r\n          last_name:this.last_name\r\n        }\r\n      })\r\n      this.$Message.success(\"edit successfully\");\r\n      this.getUserInfo()\r\n    },\r\n    currStyle(img) {\r\n      return `background-image:url(${img});width:150px;height:100px;`;\r\n    },\r\n    getCurrStyle() {\r\n      return `background-image:url(${\r\n        this.image_url\r\n      });background-size: cover;width:100%;height:200px;background-color:#eee;background-size: cover;`;\r\n    },\r\n    async getCommitList() {\r\n      const { data } = await this.$http({\r\n        url: this.API.COMMIT_ADD,\r\n        params: {\r\n          auther: this.$store.state.users.id\r\n        }\r\n      });\r\n      let score = 0;\r\n      data.map(item => {\r\n        score += item.score;\r\n      });\r\n      this.score = score / data.length;\r\n      this.commitList = data;\r\n    },\r\n    async getUserInfo() {\r\n      const { data } = await this.$http({\r\n        url: this.API.UPDATE_USER(this.$store.state.users.id),\r\n        method: \"get\"\r\n      });\r\n      this.$store.commit(\"users\", Object.assign(this.$store.state.users, data));\r\n      this.image_url = data.image_url;\r\n      this.last_name = data.last_name;\r\n    },\r\n    async onFileSuccess(res) {\r\n      await this.$http({\r\n        url: this.API.UPDATE_USER(this.$store.state.users.id),\r\n        method: \"PATCH\",\r\n        data: {\r\n          image_url: res.url\r\n        }\r\n      });\r\n      this.getUserInfo();\r\n    },\r\n    async getFoodList() {\r\n      const { data } = await this.$http({\r\n        url: this.API.FOOD_LIST,\r\n        params: {\r\n          author: this.$store.state.users.id\r\n        }\r\n      });\r\n      this.foodList = data.sort((a, b) => {\r\n        if (a.date > b.date) {\r\n          return -1;\r\n        } else {\r\n          return 1;\r\n        }\r\n      });\r\n      \r\n    },\r\n    async getBookInfo() {\r\n      const { data } = await this.$http({\r\n        url: this.API.BOOK_LIST_Q(this.$store.state.users.id)\r\n      });\r\n      this.bookList = data.map(item => {\r\n        if (item.food_detail) {\r\n          item.food_detail = JSON.parse(item.food_detail);\r\n        }\r\n        return item;\r\n      });\r\n    },\r\n    onClickMenu(active) {\r\n      this.active = active;\r\n    },\r\n    logout() {\r\n      this.$store.commit(\"users\", {});\r\n      this.$router.replace({ name: \"Login\" });\r\n    },\r\n    onEvaluate(item) {\r\n      this.isCommit = true;\r\n      this.modal = Object.assign(this.modal, {\r\n        image_url: item.image_url,\r\n        name: item.name,\r\n        date: item.date,\r\n        score: 0,\r\n        content: \"\",\r\n        id: item.id\r\n      });\r\n    },\r\n    async onCommitAdd() {\r\n      await this.$http({\r\n        url: this.API.COMMIT_ADD,\r\n        method: \"post\",\r\n        data: {\r\n          description: this.modal.content,\r\n          score: this.modal.score,\r\n          auther: this.$store.state.users.id,\r\n          food: this.modal.id\r\n        }\r\n      });\r\n      this.isCommit = false;\r\n      //刷新列表\r\n      this.getBookInfo();\r\n      this.$Message.success(\"Evaluation success!\");\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"./style.less\";\r\n</style>\r\n"],"sourceRoot":"src/views/person"}]}