{"remainingRequest":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js!/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/li/Desktop/foodish/src/views/info/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/li/Desktop/foodish/src/views/info/index.vue","mtime":1550391038000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport FoodItem from \"@/components/FoodItem\";\nimport CommitItem from \"@/components/CommitItem\";\nexport default {\n  components: {\n    FoodItem: FoodItem,\n    CommitItem: CommitItem\n  },\n  data: function data() {\n    return {\n      userid: \"\",\n      item: {},\n      forms: {},\n      rules: {},\n      flavorList: [],\n      dislikeList: [],\n      bookList: [],\n      commitList: [],\n      userName: \"\"\n    };\n  },\n  computed: {\n    isPerson: function isPerson() {\n      return this.item.author === this.$store.state.users.id;\n    },\n    isBooked: function isBooked() {\n      var _this = this;\n\n      var result = this.bookList.find(function (item) {\n        return item.food === _this.item.id;\n      });\n      return result ? true : false;\n    }\n  },\n  created: function () {\n    var _created = _asyncToGenerator(\n    /*#__PURE__*/\n    regeneratorRuntime.mark(function _callee() {\n      return regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              this.flavorList = this.$utils.flavor;\n              this.dislikeList = this.$utils.dislike;\n              _context.next = 4;\n              return this.getInfo();\n\n            case 4:\n              this.getBookInfo();\n              this.getCommitList();\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function created() {\n      return _created.apply(this, arguments);\n    }\n\n    return created;\n  }(),\n  methods: {\n    getCommitList: function () {\n      var _getCommitList = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2() {\n        var id, _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                id = this.$route.query.id;\n                _context2.next = 3;\n                return this.$http({\n                  url: this.API.COMMIT_ADD,\n                  params: {\n                    food: id\n                  }\n                });\n\n              case 3:\n                _ref = _context2.sent;\n                data = _ref.data;\n                this.commitList = data;\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getCommitList() {\n        return _getCommitList.apply(this, arguments);\n      }\n\n      return getCommitList;\n    }(),\n    getBookInfo: function () {\n      var _getBookInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee3() {\n        var _ref2, data;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.$http({\n                  url: this.API.BOOK_LIST_Q(this.$store.state.users.id)\n                });\n\n              case 2:\n                _ref2 = _context3.sent;\n                data = _ref2.data;\n                this.bookList = data;\n\n              case 5:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getBookInfo() {\n        return _getBookInfo.apply(this, arguments);\n      }\n\n      return getBookInfo;\n    }(),\n    onDelete: function () {\n      var _onDelete = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee4(_ref3) {\n        var id, content, currDate;\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                id = _ref3.id, content = _ref3.content;\n                currDate = +new Date();\n\n                if (!(this.item.date - currDate < 24 * 60 * 60 * 1000)) {\n                  _context4.next = 5;\n                  break;\n                }\n\n                this.$Modal.error({\n                  title: \"Tips\",\n                  content: \"Sorry , you cannot cancel it now!\"\n                });\n                return _context4.abrupt(\"return\");\n\n              case 5:\n                _context4.next = 7;\n                return this.$http({\n                  url: this.API.FOOD_UPDATE(id),\n                  method: \"put\",\n                  data: {\n                    content: content,\n                    is_cancel: true\n                  }\n                });\n\n              case 7:\n                this.$Message.success(\"You have cancel it successfull!\");\n                this.$router.replace({\n                  name: \"Home\"\n                });\n\n              case 9:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function onDelete(_x) {\n        return _onDelete.apply(this, arguments);\n      }\n\n      return onDelete;\n    }(),\n    //取消预订\n    onDeleteReserve: function () {\n      var _onDeleteReserve = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee5(id) {\n        var currDate;\n        return regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                currDate = +new Date();\n\n                if (!(this.item.date - currDate < 24 * 60 * 60 * 1000)) {\n                  _context5.next = 4;\n                  break;\n                }\n\n                this.$Modal.error({\n                  title: \"Tips\",\n                  content: \"Sorry , you cannot cancel it now!\"\n                });\n                return _context5.abrupt(\"return\");\n\n              case 4:\n                _context5.next = 6;\n                return this.$http({\n                  url: this.API.BOOK_DEL(this.bookList[0].id),\n                  method: \"delete\"\n                });\n\n              case 6:\n                _context5.next = 8;\n                return this.getBookInfo();\n\n              case 8:\n                this.getInfo();\n                this.$Modal.success({\n                  title: \"Tips\",\n                  content: \"You have cancel it successfull!\"\n                });\n\n              case 10:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function onDeleteReserve(_x2) {\n        return _onDeleteReserve.apply(this, arguments);\n      }\n\n      return onDeleteReserve;\n    }(),\n    onReserve: function () {\n      var _onReserve = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee6(id) {\n        var currDate;\n        return regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                currDate = +new Date();\n\n                if (!(this.item.date - currDate < 24 * 60 * 60 * 1000)) {\n                  _context6.next = 4;\n                  break;\n                }\n\n                this.$Modal.error({\n                  title: \"Tips\",\n                  content: \"Sorry , you cannot reserve it now!\"\n                });\n                return _context6.abrupt(\"return\");\n\n              case 4:\n                _context6.next = 6;\n                return this.getInfo();\n\n              case 6:\n                if (!(this.item.book_now === this.item.max_book)) {\n                  _context6.next = 9;\n                  break;\n                }\n\n                this.$Modal.success({\n                  title: \"Tips\",\n                  content: \"Sorry , You cannot reserve it now!\"\n                });\n                return _context6.abrupt(\"return\");\n\n              case 9:\n                _context6.next = 11;\n                return this.$http({\n                  url: this.API.BOOK,\n                  method: \"post\",\n                  data: {\n                    food: id,\n                    user: this.$store.state.users.id\n                  }\n                });\n\n              case 11:\n                _context6.next = 13;\n                return this.getBookInfo();\n\n              case 13:\n                this.getInfo();\n                this.$Modal.success({\n                  title: \"Tips\",\n                  content: \"You have reserved it successfull!\"\n                });\n\n              case 15:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function onReserve(_x3) {\n        return _onReserve.apply(this, arguments);\n      }\n\n      return onReserve;\n    }(),\n    getInfo: function () {\n      var _getInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee7() {\n        var _this2 = this;\n\n        var id, _ref4, data, result, flavor, dislike;\n\n        return regeneratorRuntime.wrap(function _callee7$(_context7) {\n          while (1) {\n            switch (_context7.prev = _context7.next) {\n              case 0:\n                id = this.$route.query.id;\n                _context7.next = 3;\n                return this.$http({\n                  url: this.API.FOOD_INFO(id)\n                });\n\n              case 3:\n                _ref4 = _context7.sent;\n                data = _ref4.data;\n                result = data || {};\n                result.style += \"\";\n                result.diet += \"\";\n                flavor = result.style.split(\",\");\n                dislike = result.diet.split(\",\");\n                flavor = flavor.map(function (item) {\n                  var val = +item;\n\n                  var flavorItem = _this2.flavorList.find(function (m) {\n                    return m.val === val;\n                  });\n\n                  return flavorItem ? flavorItem.text : \"\";\n                }).join(\" \");\n                dislike = dislike.map(function (item) {\n                  var val = +item;\n\n                  var dislikeItem = _this2.dislikeList.find(function (m) {\n                    return m.val === val;\n                  });\n\n                  return dislikeItem ? dislikeItem.text : \"\";\n                }).join(\" \");\n                this.item = _objectSpread({}, result, {\n                  dislike: dislike,\n                  flavor: flavor,\n                  auther_name: this.$route.query.userName\n                });\n                console.log(this.item);\n\n              case 14:\n              case \"end\":\n                return _context7.stop();\n            }\n          }\n        }, _callee7, this);\n      }));\n\n      function getInfo() {\n        return _getInfo.apply(this, arguments);\n      }\n\n      return getInfo;\n    }()\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <div class=\"info\">\r\n    <div class=\"info-header\">\r\n      <div class=\"info-left\" @click=\"$router.back()\">\r\n        <img src=\"@/resource/fanhui.svg\" alt=\"\">\r\n      </div>\r\n      <span>Foodish</span>\r\n    </div>\r\n    <div class=\"info-main\">\r\n      <FoodItem :item=\"item\" :infoBtn=\"false\" />\r\n      <div class=\"item-main-row\">\r\n        <label>Flavor\r\n          <i></i>\r\n        </label>\r\n        <span class=\"text-ellipsis\">：{{item.flavor}}</span>\r\n      </div>\r\n      <div class=\"item-main-row\">\r\n        <label>Dislike\r\n          <i></i>\r\n        </label>\r\n        <span class=\"text-ellipsis\">：{{item.dislike}}</span>\r\n      </div>\r\n      <div class=\"item-footer\">\r\n        <Button @click=\"onDelete(item)\" v-if=\"isPerson\" size=\"large\" type=\"warning\">cancel it</Button>\r\n        <Button @click=\"onReserve(item.id)\" v-else-if=\"!isPerson&&!isBooked\" size=\"large\" type=\"warning\">reserve it</Button>\r\n        <Button @click=\"onDeleteReserve(item.id)\" v-else-if=\"!isPerson&&isBooked\" size=\"large\" type=\"warning\">cancel it</Button>\r\n      </div>\r\n      <!-- 评论 -->\r\n      <div class=\"commit\">\r\n        <CommitItem v-for=\"item in commitList\" :key=\"item.id\" :item=\"item\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport FoodItem from \"@/components/FoodItem\";\r\nimport CommitItem from \"@/components/CommitItem\";\r\nexport default {\r\n  components: { FoodItem, CommitItem },\r\n  data() {\r\n    return {\r\n      userid: \"\",\r\n      item: {},\r\n      forms: {},\r\n      rules: {},\r\n      flavorList: [],\r\n      dislikeList: [],\r\n      bookList: [],\r\n      commitList: [],\r\n      userName:\"\"\r\n    };\r\n  },\r\n  computed: {\r\n    isPerson() {\r\n      return this.item.author === this.$store.state.users.id;\r\n    },\r\n    isBooked() {\r\n      const result = this.bookList.find(item => {\r\n        return item.food === this.item.id;\r\n      });\r\n      return result ? true : false;\r\n    }\r\n  },\r\n  async created() {\r\n    this.flavorList = this.$utils.flavor;\r\n    this.dislikeList = this.$utils.dislike;\r\n    await this.getInfo();\r\n    this.getBookInfo();\r\n    this.getCommitList();\r\n  },\r\n  methods: {\r\n    async getCommitList() {\r\n      const { id } = this.$route.query;\r\n      const { data } = await this.$http({\r\n        url: this.API.COMMIT_ADD,\r\n        params: {\r\n          food: id\r\n        }\r\n      });\r\n      this.commitList = data;\r\n    },\r\n    async getBookInfo() {\r\n      const { data } = await this.$http({\r\n        url: this.API.BOOK_LIST_Q(this.$store.state.users.id)\r\n      });\r\n      this.bookList = data;\r\n    },\r\n    async onDelete({ id, content }) {\r\n      const currDate = +new Date();\r\n      if (this.item.date - currDate < 24 * 60 * 60 * 1000) {\r\n        this.$Modal.error({\r\n          title: \"Tips\",\r\n          content: \"Sorry , you cannot cancel it now!\"\r\n        });\r\n        return;\r\n      }\r\n      await this.$http({\r\n        url: this.API.FOOD_UPDATE(id),\r\n        method: \"put\",\r\n        data: {\r\n          content,\r\n          is_cancel: true\r\n        }\r\n      });\r\n      this.$Message.success(\"You have cancel it successfull!\");\r\n      this.$router.replace({ name: \"Home\" });\r\n    },\r\n    //取消预订\r\n    async onDeleteReserve(id) {\r\n      const currDate = +new Date();\r\n      if (this.item.date - currDate < 24 * 60 * 60 * 1000) {\r\n        this.$Modal.error({\r\n          title: \"Tips\",\r\n          content: \"Sorry , you cannot cancel it now!\"\r\n        });\r\n        return;\r\n      }\r\n      await this.$http({\r\n        url: this.API.BOOK_DEL(this.bookList[0].id),\r\n        method: \"delete\"\r\n      });\r\n      await this.getBookInfo();\r\n      this.getInfo();\r\n      this.$Modal.success({\r\n        title: \"Tips\",\r\n        content: \"You have cancel it successfull!\"\r\n      });\r\n    },\r\n    async onReserve(id) {\r\n      const currDate = +new Date();\r\n      if (this.item.date - currDate < 24 * 60 * 60 * 1000) {\r\n        this.$Modal.error({\r\n          title: \"Tips\",\r\n          content: \"Sorry , you cannot reserve it now!\"\r\n        });\r\n        return;\r\n      }\r\n      await this.getInfo();\r\n      if (this.item.book_now === this.item.max_book) {\r\n        this.$Modal.success({\r\n          title: \"Tips\",\r\n          content: \"Sorry , You cannot reserve it now!\"\r\n        });\r\n        return;\r\n      }\r\n      await this.$http({\r\n        url: this.API.BOOK,\r\n        method: \"post\",\r\n        data: { food: id, user: this.$store.state.users.id }\r\n      });\r\n      await this.getBookInfo();\r\n      this.getInfo();\r\n      this.$Modal.success({\r\n        title: \"Tips\",\r\n        content: \"You have reserved it successfull!\"\r\n      });\r\n    },\r\n    async getInfo() {\r\n      const { id } = this.$route.query;\r\n      const { data } = await this.$http({\r\n        url: this.API.FOOD_INFO(id)\r\n      });\r\n      let result = data || {};\r\n      result.style += \"\";\r\n      result.diet += \"\";\r\n      let flavor = result.style.split(\",\");\r\n      let dislike = result.diet.split(\",\");\r\n      flavor = flavor\r\n        .map(item => {\r\n          let val = +item;\r\n          let flavorItem = this.flavorList.find(m => {\r\n            return m.val === val;\r\n          });\r\n          return flavorItem ? flavorItem.text : \"\";\r\n        })\r\n        .join(\" \");\r\n\r\n      dislike = dislike\r\n        .map(item => {\r\n          let val = +item;\r\n          let dislikeItem = this.dislikeList.find(m => {\r\n            return m.val === val;\r\n          });\r\n          return dislikeItem ? dislikeItem.text : \"\";\r\n        })\r\n        .join(\" \");\r\n      this.item = {\r\n        ...result,\r\n        dislike,\r\n        flavor,\r\n        auther_name :this.$route.query.userName\r\n      };\r\n      console.log(this.item)\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"./style.less\";\r\n</style>\r\n"],"sourceRoot":"src/views/info"}]}