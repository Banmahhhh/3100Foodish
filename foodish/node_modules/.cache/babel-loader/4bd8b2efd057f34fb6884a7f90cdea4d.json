{"remainingRequest":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js!/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/li/Desktop/foodish/src/views/post/index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/li/Desktop/foodish/src/views/post/index.vue","mtime":1548770518000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/li/Desktop/foodish/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _objectSpread from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"regenerator-runtime/runtime\";\nimport _asyncToGenerator from \"/Users/li/Desktop/foodish/node_modules/@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport \"core-js/modules/es6.array.filter\";\nimport \"core-js/modules/es6.array.find\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport * as Rules from \"@/utils/validate\";\nexport default {\n  data: function data() {\n    return {\n      isShow: false,\n      forms: {\n        image_url: \"\",\n        name: \"\",\n        //菜品名字\n        price: 0,\n        //价格\n        place: \"\",\n        date: \"\",\n        max_book: 0,\n        //最大预定数量\n        content: \"\",\n        //简介\n        book_now: \"\",\n        //当前预定数量\n        diet: \"\",\n        //忌口类型\n        style: \"\",\n        //菜品口味类型\n        author: \"\" //创建的作者\n\n      },\n      flavor: [],\n      dislike: [],\n      rules: {\n        image_url: Rules.required(\"the is required\"),\n        name: Rules.required(\"the is required\"),\n        price: Rules.number(\"the is required\", {\n          min: 1\n        }),\n        place: Rules.required(\"the is required\"),\n        date: {\n          type: \"date\",\n          required: true,\n          message: \"the is required\",\n          trigger: \"change\"\n        },\n        max_book: Rules.number(\"the is required\", {\n          min: 1\n        }),\n        content: Rules.required(\"the is required\")\n      },\n      flavorList: [],\n      dislikeList: [],\n      options: {\n        disabledDate: function disabledDate(date) {\n          return date && date.valueOf() <= new Date().valueOf() + 24 * 60 * 60 * 1000;\n        }\n      }\n    };\n  },\n  created: function created() {\n    this.flavorList = this.$utils.flavor;\n    this.dislikeList = this.$utils.dislike;\n  },\n  methods: {\n    getIsActive: function getIsActive(type, val, list) {\n      var v = this[type].find(function (item) {\n        return item === val;\n      });\n      return v ? \"primary\" : \"blue\";\n    },\n    onTagSelect: function onTagSelect(type, val) {\n      var list = this[type];\n      var v = list.find(function (item) {\n        return item === val;\n      });\n\n      if (v) {\n        this[type] = list.filter(function (item) {\n          return item !== val;\n        });\n      } else {\n        this[type].push(val);\n      }\n    },\n    submit: function () {\n      var _submit = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee() {\n        var _this = this;\n\n        var result, _ref, data;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.$refs.form.validate();\n\n              case 2:\n                result = _context.sent;\n\n                if (result) {\n                  _context.next = 5;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 5:\n                _context.prev = 5;\n                _context.next = 8;\n                return this.$http({\n                  url: this.API.FOOD,\n                  method: \"post\",\n                  data: this.getParams()\n                });\n\n              case 8:\n                _ref = _context.sent;\n                data = _ref.data;\n                this.isShow = true;\n                setTimeout(function () {\n                  _this.$router.replace({\n                    name: \"Home\"\n                  });\n                }, 2000);\n                _context.next = 17;\n                break;\n\n              case 14:\n                _context.prev = 14;\n                _context.t0 = _context[\"catch\"](5);\n                this.$Message.error(\"error\");\n\n              case 17:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[5, 14]]);\n      }));\n\n      function submit() {\n        return _submit.apply(this, arguments);\n      }\n\n      return submit;\n    }(),\n    onFileSuccess: function () {\n      var _onFileSuccess = _asyncToGenerator(\n      /*#__PURE__*/\n      regeneratorRuntime.mark(function _callee2(res) {\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.forms.image_url = res.url;\n\n              case 1:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function onFileSuccess(_x) {\n        return _onFileSuccess.apply(this, arguments);\n      }\n\n      return onFileSuccess;\n    }(),\n    getParams: function getParams() {\n      var author = \"\";\n\n      try {\n        author = this.$store.state.users.id;\n      } catch (error) {}\n\n      return _objectSpread({}, this.forms, {\n        book_now: 0,\n        date: +new Date(this.forms.date),\n        price: this.forms.price * 100,\n        diet: this.dislike.join(\",\"),\n        style: this.flavor.join(\",\"),\n        author: author\n      });\n    }\n  }\n};",{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8DA,OAAA,KAAA,KAAA,MAAA,kBAAA;AACA,eAAA;AACA,EAAA,IADA,kBACA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,KADA;AAEA,MAAA,KAAA,EAAA;AACA,QAAA,SAAA,EAAA,EADA;AAEA,QAAA,IAAA,EAAA,EAFA;AAEA;AACA,QAAA,KAAA,EAAA,CAHA;AAGA;AACA,QAAA,KAAA,EAAA,EAJA;AAKA,QAAA,IAAA,EAAA,EALA;AAMA,QAAA,QAAA,EAAA,CANA;AAMA;AACA,QAAA,OAAA,EAAA,EAPA;AAOA;AACA,QAAA,QAAA,EAAA,EARA;AAQA;AACA,QAAA,IAAA,EAAA,EATA;AASA;AACA,QAAA,KAAA,EAAA,EAVA;AAUA;AACA,QAAA,MAAA,EAAA,EAXA,CAWA;;AAXA,OAFA;AAeA,MAAA,MAAA,EAAA,EAfA;AAgBA,MAAA,OAAA,EAAA,EAhBA;AAiBA,MAAA,KAAA,EAAA;AACA,QAAA,SAAA,EAAA,KAAA,CAAA,QAAA,CAAA,iBAAA,CADA;AAEA,QAAA,IAAA,EAAA,KAAA,CAAA,QAAA,CAAA,iBAAA,CAFA;AAGA,QAAA,KAAA,EAAA,KAAA,CAAA,MAAA,CAAA,iBAAA,EAAA;AACA,UAAA,GAAA,EAAA;AADA,SAAA,CAHA;AAMA,QAAA,KAAA,EAAA,KAAA,CAAA,QAAA,CAAA,iBAAA,CANA;AAOA,QAAA,IAAA,EAAA;AACA,UAAA,IAAA,EAAA,MADA;AAEA,UAAA,QAAA,EAAA,IAFA;AAGA,UAAA,OAAA,EAAA,iBAHA;AAIA,UAAA,OAAA,EAAA;AAJA,SAPA;AAaA,QAAA,QAAA,EAAA,KAAA,CAAA,MAAA,CAAA,iBAAA,EAAA;AACA,UAAA,GAAA,EAAA;AADA,SAAA,CAbA;AAgBA,QAAA,OAAA,EAAA,KAAA,CAAA,QAAA,CAAA,iBAAA;AAhBA,OAjBA;AAmCA,MAAA,UAAA,EAAA,EAnCA;AAoCA,MAAA,WAAA,EAAA,EApCA;AAqCA,MAAA,OAAA,EAAA;AACA,QAAA,YADA,wBACA,IADA,EACA;AACA,iBACA,IAAA,IAAA,IAAA,CAAA,OAAA,MAAA,IAAA,IAAA,GAAA,OAAA,KAAA,KAAA,EAAA,GAAA,EAAA,GAAA,IADA;AAGA;AALA;AArCA,KAAA;AA6CA,GA/CA;AAgDA,EAAA,OAhDA,qBAgDA;AACA,SAAA,UAAA,GAAA,KAAA,MAAA,CAAA,MAAA;AACA,SAAA,WAAA,GAAA,KAAA,MAAA,CAAA,OAAA;AACA,GAnDA;AAoDA,EAAA,OAAA,EAAA;AACA,IAAA,WADA,uBACA,IADA,EACA,GADA,EACA,IADA,EACA;AACA,UAAA,CAAA,GAAA,KAAA,IAAA,EAAA,IAAA,CAAA,UAAA,IAAA,EAAA;AACA,eAAA,IAAA,KAAA,GAAA;AACA,OAFA,CAAA;AAGA,aAAA,CAAA,GAAA,SAAA,GAAA,MAAA;AACA,KANA;AAOA,IAAA,WAPA,uBAOA,IAPA,EAOA,GAPA,EAOA;AACA,UAAA,IAAA,GAAA,KAAA,IAAA,CAAA;AACA,UAAA,CAAA,GAAA,IAAA,CAAA,IAAA,CAAA,UAAA,IAAA,EAAA;AACA,eAAA,IAAA,KAAA,GAAA;AACA,OAFA,CAAA;;AAGA,UAAA,CAAA,EAAA;AACA,aAAA,IAAA,IAAA,IAAA,CAAA,MAAA,CAAA,UAAA,IAAA,EAAA;AACA,iBAAA,IAAA,KAAA,GAAA;AACA,SAFA,CAAA;AAGA,OAJA,MAIA;AACA,aAAA,IAAA,EAAA,IAAA,CAAA,GAAA;AACA;AACA,KAnBA;AAoBA,IAAA,MApBA;AAAA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBAqBA,KAAA,KAAA,CAAA,IAAA,CAAA,QAAA,EArBA;;AAAA;AAqBA,gBAAA,MArBA;;AAAA,oBAsBA,MAtBA;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA,uBAwBA,KAAA,KAAA,CAAA;AACA,kBAAA,GAAA,EAAA,KAAA,GAAA,CAAA,IADA;AAEA,kBAAA,MAAA,EAAA,MAFA;AAGA,kBAAA,IAAA,EAAA,KAAA,SAAA;AAHA,iBAAA,CAxBA;;AAAA;AAAA;AAwBA,gBAAA,IAxBA,QAwBA,IAxBA;AA6BA,qBAAA,MAAA,GAAA,IAAA;AACA,gBAAA,UAAA,CAAA,YAAA;AACA,kBAAA,KAAA,CAAA,OAAA,CAAA,OAAA,CAAA;AAAA,oBAAA,IAAA,EAAA;AAAA,mBAAA;AACA,iBAFA,EAEA,IAFA,CAAA;AA9BA;AAAA;;AAAA;AAAA;AAAA;AAkCA,qBAAA,QAAA,CAAA,KAAA,CAAA,OAAA;;AAlCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAqCA,IAAA,aArCA;AAAA;AAAA;AAAA,gDAqCA,GArCA;AAAA;AAAA;AAAA;AAAA;AAsCA,qBAAA,KAAA,CAAA,SAAA,GAAA,GAAA,CAAA,GAAA;;AAtCA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAwCA,IAAA,SAxCA,uBAwCA;AACA,UAAA,MAAA,GAAA,EAAA;;AACA,UAAA;AACA,QAAA,MAAA,GAAA,KAAA,MAAA,CAAA,KAAA,CAAA,KAAA,CAAA,EAAA;AACA,OAFA,CAEA,OAAA,KAAA,EAAA,CAAA;;AACA,+BACA,KAAA,KADA;AAEA,QAAA,QAAA,EAAA,CAFA;AAGA,QAAA,IAAA,EAAA,CAAA,IAAA,IAAA,CAAA,KAAA,KAAA,CAAA,IAAA,CAHA;AAIA,QAAA,KAAA,EAAA,KAAA,KAAA,CAAA,KAAA,GAAA,GAJA;AAKA,QAAA,IAAA,EAAA,KAAA,OAAA,CAAA,IAAA,CAAA,GAAA,CALA;AAMA,QAAA,KAAA,EAAA,KAAA,MAAA,CAAA,IAAA,CAAA,GAAA,CANA;AAOA,QAAA,MAAA,EAAA;AAPA;AASA;AAtDA;AApDA,CAAA","sourcesContent":["<template>\r\n  <div class=\"post\">\r\n    <div class=\"post-header\">\r\n      <div class=\"post-left\" @click=\"$router.push({name:'Home'})\">\r\n        <img src=\"@/resource/fanhui.svg\" alt=\"\">\r\n      </div>\r\n      <span>Foodish</span>\r\n    </div>\r\n    <div class=\"post-main\">\r\n      <Form class=\"post-main-form\" :label-width=\"100\" ref=\"form\" :model=\"forms\" :rules=\"rules\">\r\n        <div class=\"post-main-left\">\r\n          <FormItem prop=\"image_url\" :label-width=\"0\">\r\n            <Upload :on-success=\"onFileSuccess\" name=\"img\" :show-upload-list=\"false\" multiple type=\"drag\" :action=\"API.IMAGE_UPLOAD\">\r\n              <div v-if=\"!forms.image_url\" style=\"padding: 120px 0\">\r\n                <Icon type=\"ios-cloud-upload\" size=\"52\" style=\"color: #3399ff\"></Icon>\r\n              </div>\r\n              <div v-else :style=\"`background:url(${forms.image_url}) no-repeat top center;\r\n                background-size: cover;width:100%;height:300px`\">\r\n              </div>\r\n            </Upload>\r\n          </FormItem>\r\n        </div>\r\n        <div class=\"post-main-right\">\r\n          <FormItem label=\"Food name\" prop=\"name\">\r\n            <Input type=\"text\" v-model=\"forms.name\" placeholder=\"\" style=\"width:450px\"></Input>\r\n          </FormItem>\r\n          <FormItem label=\"Price\" prop=\"price\">\r\n            <InputNumber v-model=\"forms.price\" :max=\"10000\" :min=\"1\" style=\"width:450px\"></InputNumber>\r\n          </FormItem>\r\n          <FormItem label=\"Date\" prop=\"date\">\r\n            <DatePicker :options=\"options\" v-model=\"forms.date\" type=\"datetime\" style=\"width:450px\"></DatePicker>\r\n          </FormItem>\r\n          <FormItem label=\"Place\" prop=\"place\">\r\n            <Input type=\"text\" v-model=\"forms.place\" style=\"width:450px\"></Input>\r\n          </FormItem>\r\n          <FormItem label=\"People\" prop=\"max_book\">\r\n            <InputNumber :max=\"10000\" v-model=\"forms.max_book\" :min=\"1\" style=\"width:450px\"></InputNumber>\r\n          </FormItem>\r\n        </div>\r\n        <div class=\"post-main-desc\">\r\n          <FormItem label=\"Desc\" prop=\"content\">\r\n            <Input type=\"textarea\" v-model=\"forms.content\" :rows=\"4\"></Input>\r\n          </FormItem>\r\n          <FormItem label=\"Flavor\" prop=\"flavor\">\r\n            <Tag @click.native=\"onTagSelect('flavor',item.val)\" :color=\"getIsActive('flavor',item.val,flavorList)\" v-for=\"item in flavorList\" :key=\"item.val\">{{item.text}}</Tag>\r\n          </FormItem>\r\n          <FormItem label=\"Pay attention\" prop=\"dislike\">\r\n            <Tag @click.native=\"onTagSelect('dislike',item.val)\" :color=\"getIsActive('dislike',item.val,dislikeList)\" v-for=\"item in dislikeList\" :key=\"item.val\">{{item.text}}</Tag>\r\n          </FormItem>\r\n          <FormItem>\r\n            <Button @click=\"submit\" long size=\"large\" type=\"warning\">Submit</Button>\r\n          </FormItem>\r\n        </div>\r\n      </Form>\r\n    </div>\r\n    <div class=\"text-modal\" v-if=\"isShow\">\r\n      <span style=\"color:#f95;font-size:100px\">Weell Done!</span>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as Rules from \"@/utils/validate\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      isShow: false,\r\n      forms: {\r\n        image_url: \"\",\r\n        name: \"\", //菜品名字\r\n        price: 0, //价格\r\n        place: \"\",\r\n        date: \"\",\r\n        max_book: 0, //最大预定数量\r\n        content: \"\", //简介\r\n        book_now: \"\", //当前预定数量\r\n        diet: \"\", //忌口类型\r\n        style: \"\", //菜品口味类型\r\n        author: \"\" //创建的作者\r\n      },\r\n      flavor: [],\r\n      dislike: [],\r\n      rules: {\r\n        image_url: Rules.required(\"the is required\"),\r\n        name: Rules.required(\"the is required\"),\r\n        price: Rules.number(\"the is required\", {\r\n          min: 1\r\n        }),\r\n        place: Rules.required(\"the is required\"),\r\n        date: {\r\n          type: \"date\",\r\n          required: true,\r\n          message: \"the is required\",\r\n          trigger: \"change\"\r\n        },\r\n        max_book: Rules.number(\"the is required\", {\r\n          min: 1\r\n        }),\r\n        content: Rules.required(\"the is required\")\r\n      },\r\n      flavorList: [],\r\n      dislikeList: [],\r\n      options: {\r\n        disabledDate(date) {\r\n          return (\r\n            date && date.valueOf() <= new Date().valueOf() + 24 * 60 * 60 * 1000\r\n          );\r\n        }\r\n      }\r\n    };\r\n  },\r\n  created() {\r\n    this.flavorList = this.$utils.flavor;\r\n    this.dislikeList = this.$utils.dislike;\r\n  },\r\n  methods: {\r\n    getIsActive(type, val, list) {\r\n      const v = this[type].find(item => {\r\n        return item === val;\r\n      });\r\n      return v ? \"primary\" : \"blue\";\r\n    },\r\n    onTagSelect(type, val) {\r\n      const list = this[type];\r\n      const v = list.find(item => {\r\n        return item === val;\r\n      });\r\n      if (v) {\r\n        this[type] = list.filter(item => {\r\n          return item !== val;\r\n        });\r\n      } else {\r\n        this[type].push(val);\r\n      }\r\n    },\r\n    async submit() {\r\n      const result = await this.$refs.form.validate();\r\n      if (!result) return;\r\n      try {\r\n        const { data } = await this.$http({\r\n          url: this.API.FOOD,\r\n          method: \"post\",\r\n          data: this.getParams()\r\n        });\r\n        this.isShow = true;\r\n        setTimeout(() => {\r\n          this.$router.replace({ name: \"Home\" });\r\n        }, 2000);\r\n      } catch (error) {\r\n        this.$Message.error(\"error\");\r\n      }\r\n    },\r\n    async onFileSuccess(res) {\r\n      this.forms.image_url = res.url;\r\n    },\r\n    getParams() {\r\n      let author = \"\";\r\n      try {\r\n        author = this.$store.state.users.id;\r\n      } catch (error) {}\r\n      return {\r\n        ...this.forms,\r\n        book_now: 0,\r\n        date: +new Date(this.forms.date),\r\n        price: this.forms.price * 100,\r\n        diet: this.dislike.join(\",\"),\r\n        style: this.flavor.join(\",\"),\r\n        author\r\n      };\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n@import \"./style.less\";\r\n.text-modal {\r\n  position: fixed;\r\n  top: 0;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  font-family: \"PingFang SC\";\r\n}\r\n</style>\r\n"],"sourceRoot":"src/views/post"}]}